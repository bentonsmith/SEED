{% extends "base.html" %}
{% load static %}

{% block title %}
Edit Client
{% endblock title %}

{% block resources %}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
  integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
  crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
   integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
   crossorigin=""></script>


{% endblock resources %}

{% block content %}

<form class="" action="/edit_client/{{current_client.id}}" method="post">
  {% csrf_token %}
  <p class="card-text">
    <div class="row">
      <div class="col-md-6 input-label">
        {{form.first_name.errors}}
        <label for="{{form.first_name.id_for_label}}">First Name</label>
        <div class="input-group">
          {{form.first_name}}
        </div>
        <br>
      </div>
      <div class="col-md-6 input-label">
        {{form.last_name.errors}}
        <label for="{{form.last_name.id_for_label}}">Last Name</label>
        <div class="input-group">
          {{form.last_name}}
        </div>
        <br>
      </div>
    </div>
    <div id='mapid' style="width: 400px; height: 300px"></div>
    <script>
    var mymap = L.map('mapid').setView([{{current_client.lat}}, {{current_client.lon}}], 13);
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox.streets',
        accessToken: 'pk.eyJ1IjoiYmVudG9uc21pdGgiLCJhIjoiY2pqZjl0ZjBvMGN1YjN2bXN1Y2ZvcDY0ayJ9.V8OFcjbPM7l1gaMsWQxudA'
    }).addTo(mymap);
    var myIcon = L.icon({
      iconUrl: "{% static "map_pin.png" %}",
      iconSize: [38, 70],
      iconAnchor: [19, 70],
    });
    var marker = L.marker([{{current_client.lat}}, {{current_client.lon}}], {icon: myIcon, draggable: 'True', title:'Drag to set location', autoPan: 'True'}).addTo(mymap);
    marker.on('moveend', setlatlon);
    function setlatlon(){

      var newlocation = marker.getLatLng();
      console.log(newlocation);
      $('#id_lat').attr('value', newlocation.lat);
      $('#id_lon').attr('value', newlocation.lng);
    }
    </script>
    <div class="row">
      <div class="col-md-6 input-label">
        {{form.gender.errors}}
        <label for="{{form.gender.id_for_label}}">Gender</label>
        <div class="input-group">
          {{form.gender}}
        </div>
        <br>
      </div>
      <div class="col-md-6 input-label">
        {{form.email.errors}}
        <label for="{{form.email.id_for_label}}">Email</label>
        <div class="input-group">
          {{form.email}}
        </div>
        <br>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 input-label">
        {{form.phone_number.errors}}
        <label for="{{form.phone_number.id_for_label}}">Phone Number</label>
        <div class="input-group">
          {{form.phone_number}}
        </div>
        <br>
      </div>
      <div class="col-md-6 input-label">
        {{form.tagalog_needed.errors}}
        <label for="{{form.tagalog_needed.id_for_label}}">Tagalog Needed</label>
        <div class="input-group">
          {{form.tagalog_needed}}
        </div>
        <br>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 input-label">
        {{form.street_address.errors}}
        <label for="{{form.street_address.id_for_label}}">Street Address</label>
        <div class="input-group">
          {{form.street_address}}
        </div>
        <br>
      </div>
      <div class="col-md-6 input-label">
        {{form.city.errors}}
        <label for="{{form.city.id_for_label}}">City</label>
        <div class="input-group">
          {{form.city}}
        </div>
        <br>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 input-label">
        {{form.zipcode.errors}}
        <label for="{{form.zipcode.id_for_label}}">Zipcode</label>
        <div class="input-group">
          {{form.zipcode}}
        </div>
        <br>
      </div>
      <div class="col-md-6 input-label">
        {{form.country.errors}}
        <label for="{{form.country.id_for_label}}">Country</label>
        <div class="input-group">
          {{form.country}}
        </div>
        <br>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 input-label">
        {{form.barangay.errors}}
        <label for="{{form.barangay.id_for_label}}">Barangay</label>
        <div class="input-group">
          {{form.barangay}}
        </div>
        <br>
      </div>
      <div class="col-md-6 input-label">
        {{form.lat.errors}}
        <label for="{{form.lat.id_for_label}}">Latitude</label>
        <div id="enterlat" class="input-group">
          {{form.lat}}
        </div>
        <br>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 input-label">
        {{form.lon.errors}}
        <label for="{{form.lon.id_for_label}}">Longitude</label>
        <div id="enterlon" class="input-group">
          {{form.lon}}
        </div>
        <br>
      </div>
      <div class="col-md-6 input-label">
        {{form.business_name.errors}}
        <label for="{{form.business_name.id_for_label}}">Business Name</label>
        <div class="input-group">
          {{form.business_name}}
        </div>
        <br>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 input-label">
        {{form.business_type.errors}}
        <label for="{{form.business_type.id_for_label}}">Business Type</label>
        <div class="input-group">
          {{form.business_type}}
        </div>
        <br>
      </div>
      <div class="col-md-6 input-label">
        {{form.transportation_method.errors}}
        <label for="{{form.transportation_method.id_for_label}}">Transportation Method</label>
        <div class="input-group">
          {{form.transportation_method}}
        </div>
        <br>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 input-label">
        {{form.bio.errors}}
        <label for="{{form.bio.id_for_label}}">Bio</label>
        <div class="input-group">
          {{form.bio}}
        </div>
        <br>
      </div>
    </div>
</p>
<input class="btn btn-success" value="Save" type="submit"></input>
{% if current_client.active == True %}
<a href="/delete_client/{{current_client.id}}" class="btn btn-danger">Deactivate</a>
{% elif current_client.active == False %}
<a href="/delete_client/{{current_client.id}}" class="btn btn-danger">Reactivate</a>
{% endif %}
</form>
{% endblock content %}
